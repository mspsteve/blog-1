# 滚动

## 滚动条隐藏但可滚动

```css
/* Chrome，Safari 和 Opera */
.container::-webkit-scrollbar {
  display: none;
}

/* IE 或 Edge */
.container {
  -ms-overflow-style: none;
}
```

至于 Firefox，没有任何办法隐藏滚动条。


## 滚动条样式

IE 5.5 版本以后，允许修改滚动条的颜色。

```css
body {
  scrollbar-face-color: blue;
}
```

WebKit 的开发者在 2009 年提出了（修改滚动条）样式的方案。以下是使用 -webkit 前缀在支持相关样式的浏览器中模拟 macOS 滚动条样式的代码：

```css
::-webkit-scrollbar {
  width: 8px;
}
::-webkit-scrollbar-thumb {
  background-color: #c1c1c1;
  border-radius: 4px;
}
```

Chrome、Safari、Opera 甚至于 UC 浏览器或者三星自带的桌面浏览器都支持（上述 CSS）。Edge 也有计划实现它们。但三年过去了，该计划仍在中等优先级中（而尚未被实现）。


## 流畅的滚动

通过锚点链接来跳转到页面上的不同区块时，若想实现平滑地滚动，可添加一行代码：

```css
html {
  scroll-behavior: smooth;
}
```

目前`scroll-behavior`仅在 Chrome、 Firefox 与 Opera 上被支持，但我们希望它能被广泛支持，因为使用 CSS （比使用 JavaScript）在解决页面滚动问题时优雅得多，并更符合“渐进增强”的模式。


## `position: sticky`

`position: sticky`是结合了`position: relative`和`position: fixed`两种定位功能于一体的特殊定位，适用于一些特殊场景。

元素先按照普通文档流定位，然后相对于该元素在流中的 flow root（BFC）和 containing block（最近的块级祖先元素）定位。而后，元素定位表现为在跨越特定阈值前为相对定位，之后为固定定位。

这个特定阈值指的是`top`，`right`，`bottom`或`left`之一，换言之，指定`top`，`right`，`bottom`或 `left`四个阈值其中之一，才可使粘性定位生效。否则其行为与相对定位相同。


## 在视窗中显示

当你需要实现图片懒加载或者无限滚动时，需要确定元素是否出现在视窗中。这可以在事件监听器中处理，最常见的解决方案是使用`element.getBoundingClientRect()`：

```js
window.addEventListener('scroll', () => {
  const rect = elem.getBoundingClientRect();
  const inViewport = rect.bottom > 0 && rect.right > 0 &&
                     rect.left < window.innerWidth &&
                     rect.top < window.innerHeight;
});
```

上述代码的问题在于每次调用`getBoundingClientRect`时都会触发回流，严重地影响了性能。在事件处理函数中调用（`getBoundingClientRect`）尤为糟糕，就算使用了函数节流（的技巧）也可能对性能没多大帮助。
（回流是指浏览器为局部或整体地重绘某个元素，需要重新计算该元素在文档中的位置与形状。）

在2016年后，可以通过使用 Intersection Observer 这一 API 来解决问题。它允许你追踪目标元素与其祖先元素或视窗的交叉状态。此外，尽管只有一部分元素出现在视窗中，哪怕只有一像素，也可以选择触发回调函数：

```js
const observer = new IntersectionObserver(callback, options);
observer.observe(element);
```

此 API 被广泛地支持，但仍有一些浏览器需要 polyfill。尽管如此，它仍是目前最好的解决方案。


## 滚动边界问题

如果你的弹框或下拉列表是可滚动的，那你务必要了解连锁滚动相关的问题：当用户滚动到（弹框或下拉列表）末尾（后再继续滚动时），整个页面都会开始滚动。


## `passive: true`



## Reference

- [【第1286期】滑向未来：现代 JavaScript 与 CSS 滚动实现指南](https://mp.weixin.qq.com/s/tG56t5pd1Kw_O2NBXGAk6Q)
- [使用 position:sticky 实现粘性布局](http://www.cnblogs.com/coco1s/p/6402723.html)